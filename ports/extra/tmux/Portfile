# Description: Terminal multiplexer
# URL: https://github.com/tmux/tmux
# Depends: ncurses

name=tmux
version=3.6a
source=https://github.com/tmux/tmux/releases/download/$version/tmux-$version.tar.gz

build() {
    # Build libevent first
    curl -fL -o libevent.tar.gz \
        "https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz"
    tar xzf libevent.tar.gz
    cd libevent-2.1.12-stable
    ./configure --host=$CROSS --prefix=$SRC/libevent-out \
        --disable-shared --disable-openssl --disable-samples
    make -j$(nproc) && make install
    cd ..

    cd $name-$version
    PKG_CONFIG_PATH="" \
    ./configure --host=$CROSS --prefix=/usr \
        --enable-static \
        CFLAGS="-Os -I$SRC/libevent-out/include -I$SYSROOT/usr/include/ncursesw -I$SYSROOT/usr/include" \
        LDFLAGS="-static -L$SRC/libevent-out/lib -L$SYSROOT/usr/lib" \
        LIBEVENT_CFLAGS="-I$SRC/libevent-out/include" \
        LIBEVENT_LIBS="-L$SRC/libevent-out/lib -levent_core -lpthread"
    make -j$(nproc)
    make DESTDIR=$PKG install
}
