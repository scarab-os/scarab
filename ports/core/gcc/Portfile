# Description: GNU Compiler Collection
# URL: https://gcc.gnu.org
# Depends: zlib

name=gcc
version=15.2.0
source=https://ftp.gnu.org/gnu/gcc/gcc-$version/gcc-$version.tar.xz

build() {
    cd $name-$version
    
    # Download and link GMP/MPFR/MPC internally
    [ -d gmp ] || {
        curl -fL https://ftp.gnu.org/gnu/gmp/gmp-6.3.0.tar.xz | tar xJ
        ln -sf gmp-6.3.0 gmp
    }
    [ -d mpfr ] || {
        curl -fL https://ftp.gnu.org/gnu/mpfr/mpfr-4.2.2.tar.xz | tar xJ
        ln -sf mpfr-4.2.2 mpfr
    }
    [ -d mpc ] || {
        curl -fL https://ftp.gnu.org/gnu/mpc/mpc-1.3.1.tar.gz | tar xz
        ln -sf mpc-1.3.1 mpc
    }
    
    mkdir build && cd build
    ../configure \
        --host=$CROSS \
        --target=$CROSS \
        --prefix=/usr \
        --disable-multilib \
        --disable-nls \
        --disable-bootstrap \
        --disable-libsanitizer \
        --enable-languages=c,c++ \
        --enable-default-pie \
        --enable-default-ssp
    make -j$(nproc)
    make DESTDIR=$PKG install
    ln -sf gcc $PKG/usr/bin/cc
}
